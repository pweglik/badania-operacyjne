% !TeX spellcheck = pl_PL
\documentclass[12pt,a4paper,openright]{mwrep}
%\documentclass[12pt,a4paper,openright]{article}

% Przemkowe importy co nie działają
%\usepackage{lmodern}
%\usepackage[T1]{polski}
%
%\usepackage[a4paper,
%            tmargin=2cm,
%            bmargin=2cm,
%            lmargin=2cm,
%            rmargin=2cm,
%            bindingoffset=0cm]{geometry}
%
%\usepackage{tocloft}
%\usepackage{hyperref}
%
%\usepackage{amsmath}
%\usepackage{amssymb}
%\usepackage{siunitx}
%
%\usepackage{listings}
%
%\usepackage{graphicx}
%\usepackage{subfig}
%\usepackage{float}
%\usepackage{booktabs}

% moje działają
\usepackage{amssymb} % symbol kąta
\usepackage[polish]{babel} % polskie nazwy
\usepackage[T1]{fontenc} % polskie znaki
\usepackage[margin=1.0in]{geometry} % marginesy
\usepackage[utf8]{inputenc}
\usepackage{listingsutf8} % bloki kodu
\usepackage{color} % kolory
\usepackage{indentfirst} % wcięcie w pierwszej linii paragrafu
\usepackage{graphicx} % obrazy
\usepackage{float} % dla image [H]
\usepackage{amsmath,amsthm,amssymb,mathtools} % matematyka dowód
\usepackage{changepage} % matematyka dowód
\usepackage{siunitx} % wyrównanie do kropki
\usepackage{makecell} % wyrównania nagłówków
%\usepackage{enumitem} % wyrównania nagłówków
\usepackage{tikz} % zbocza
\usetikzlibrary{decorations.markings}
\usepackage{hyperref} % bez obwódek wokół linków

\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

\newtheorem{definition}{Def}

\begin{document}

\title{
Badania operacyjne\\
Projekt\\
}

\author{\\Jakub Kosmydel\\Norbert Morawski
\\Bartłomiej Wiśniewski\\Przemysław Węglik}

\date{\today}

\maketitle

\chapter{Wstęp}
Celem naszego projektu jest znalezienie optymalnych tras linii dla autobusów, aby maksymalizować liczbę pasażerów, przy minimalnej liczbie linii autobusowych. Aby to osiągnąć, wykorzystywane są algorytmy genetyczne -  algorytmy przeszukujące przestrzeń rozwiązań, które opierają się na procesie działania mechanizmu dziedziczenia biologicznego.

W systemie założono, że pozycje oraz popularność przystanków są z góry ustalone. Stosowanie algorytmów genetycznych pozwoliło na wygenerowanie zestawu najlepszych połączeń autobusowych, które można skonfigurować dla lepszego wykorzystania zasobów oraz zwiększenie korzyści z transportu publicznego dla pasażerów.

\chapter{Opis zagadnienia}

\section{Sformułowanie problemu}
Naszym celem w projekcie jest zaprojektowanie sieci linii autobusowych pokrywającej dany obszar miejski, który już posiada sieć przystanków autobusowych. Linie te, powinny mieć możliwość obsłużenia jak największej liczby pasażerów, tworząc jak najmniej postojów oraz zatrzymując się na jak najmniejszej liczbie przystanków.

\section{Model matematyczny}

\subsection{Założenia}

\begin{enumerate}
	\item Przystankom przypisujemy ilość punktów w zależności od gęstości zaludnienia w pobliżu oraz ciekawych punktów (teatr, park itp.).
	\begin{itemize}
		\item Dla każdego przystanku obliczamy liczbę ludzi w pobliżu,
		\item Głównym punktom w Krakowie (np. D17, teatry, itp.) nadajemy wartość punktową,
		\item Dla każdego przystanku sumujemy powyższe wartości.
	\end{itemize}
	\item Rozkładamy linie komunikacyjne po mieście tak, by maksymalizować sumę zebranych punktów przez wszystkie linie.
	\item Wprowadzamy koszt dla linii: koszt ścieżki w grafie, po której jedzie + koszt utworzenia nowej linii.
	\item Linie przebiegające przez jeden przystanek dzielą się punktami,
	\item Maksymalizujemy sumę punktów zebranych przez wszystkie linie.
\end{enumerate}

\subsection{Dane}
	\begin{enumerate}
		\item $n$ - liczba linii
		\item $m$ - liczba przystanków
	\end{enumerate}

\subsubsection{Graf}

	\begin{enumerate}
		\item Wierzchołki istniejące przystanki z przypisanymi punktami,
		\item $p(j)$ - wartość punktowa przystanku:
		\begin{itemize}
            \item  W początkowej wersji liczba ta jest określona z góry,
			\item $p(j) = \sum_{i=0}^{n-1} \frac{w_{j, i}}{f(d_j, i)}$ gdzie $w_{j, i}$ to wartość obiektu (np. liczba mieszkańców w pobliżu) a $d_{j,i}$ to odległość tego bloku od przystanku, f – funkcja skalująca.
			\item Funkcja liczona dla danego przystanku $j$
		\end{itemize}
		\item Krawędzie to połączenia między przystankami.
		\item Koszt krawędzi to odległości między przystankami.
	\end{enumerate}










\subsection{Szukane}
	$x_{i,j}$ - czy linia $i$ zatrzymuje się na przystanku $j$, gdzie:
	\begin{enumerate}
		\item $i \in \left[ 0, n-1 \right]$
		\item $j \in \left[ 0, m-1 \right]$
	\end{enumerate}

\subsection{Hiperparametry}
	\begin{enumerate}
		\item $\alpha$ - koszt zatrzymania się na przystanku,
		\item $\beta$ - koszt nowej linii,
		\item $R$ - hiper parametr zbiegania.
	\end{enumerate}



$l_j = \sum_{i=0}^{n-1} x_{i, j}$\\
$p_{i, j} = \frac{p_j \cdot (1+\frac{R}{l_j})^l_j}{l_j}$ -- ile punktów linia $i$ uzyskuje z przystanku $j$

$S_{i}$ -- długość ścieżki linii $i$ w grafie

$f(x) = \sum_{i=0}^{n-1} \sum_{j=0}^{m-1} x_{i,j} * (p_{i,j}-\alpha)-S_{i}-\beta$


\chapter{Opis algorytmów}

\section{Reprezentacja środowiska}
\subsection{Reprezentacja mapy}
Mapa z przystankami jest reprezentowana jako ważony graf z biblioteki \lstinline{NetworkX}.

\subsection{Reprezentacja genotypu}
Genotyp składa się z listy linii autobusowych:
\begin{lstlisting}[language=Python]
class Genotype:
    def __init__(self, lines: list[Line]):
        self.lines = lines
\end{lstlisting}

\subsection{Reprezentacja linii}
Linia posiada następujące parametry:
\begin{enumerate}
    \item \lstinline{id} - id linii,
    \item \lstinline{stops} - przystanki, na których się zatrzymuje,
    \item \lstinline{edges} - wszystkie krawędzie, przez które linia przejeżdża,
    \item \lstinline{edge_color} - kolor linii; do reprezentacji graficznej,
    \item \lstinline{edge_style} - styl krawędzi linii; do reprezentacji graficznej,
\end{enumerate}


\begin{lstlisting}[language=Python]
class Line:
    def __init__(self, stops: list[int], best_paths):
        self.id = Line.get_next_id()
        self.stops = stops  # ordered list of stops
        self.edges = []
        self.edge_color = [...]
        self.edge_style = [...]
\end{lstlisting}

\section{Symulacja}


\section{Mutacja}

\subsection{LineMutator}
Tworzy nowe mutacje dla danej linii.

Możliwe mutacje:

\begin{enumerate}
    \item \lstinline{rotation_to_right}
    \item \lstinline{cycle_rotation}
    \item \lstinline{invert} - odwraca kolejność przystanków, pomiędzy losowymi indeksami \lstinline{start} oraz \lstinline{end},
    \item \lstinline{erase_stops} - losowo usuwa zadaną liczbę przystanków z linii,
    \item \lstinline{add_stops} - losowo dodaje zadaną liczbę przystanków, spośród tych, które w linii nie występują.
\end{enumerate}

\subsection{GenotypeMutator}

Możliwe mutacje:

\begin{enumerate}
    \item \lstinline{erase_line} - tworzy nowy genotyp, usuwając losową linię,
    \item \lstinline{create_line} - tworzy nowy genotyp, dodając losowo wygenerowaną linię,
    \item \lstinline{split_line} - tworzy nowy genotyp, rozdzielając losową, losową linię dwie różne.
    \item \lstinline{merge_lines} - tworzy nowy genotyp, łącząc w losowej kolejności zadaną liczbę losowych linii,
    \item \lstinline{cycle_stops_shift} - ???
\end{enumerate}

\section{Krzyżowanie}
\subsection{GenotypeCrosser}

\begin{enumerate}
    \item \lstinline{merge_genotypes} - tworzy nowy genotyp, łącząc losową liczbę losowych linii z dwóch danych genotypów,
    \item \lstinline{cycle_stops_shift} - ???
\end{enumerate}

\chapter{Aplikacja}

\chapter{Eksperymenty}

\chapter{Podsumowanie}

Problem generowania linii autobusowych jest bardzo skomplikowany. W celu jego rozwiązania, przydatne są algorytmy genetyczne. Z odpowiednią liczbą nowych generacji jesteśmy w stanie osiągnąć ciekawe wyniki. Nie są one jednak w pełni satysfakcjonujące.

\end{document}
